# FPGA串口协议学习笔记
## 背景介绍
  在使用verilog实现串口协议的时候本人不幸经历了一些小困难，但是基于对唯物辩证法>的高度信任，本人终于发现了困难产生的原因，并解决了问题，取得了收获。

## 基本概念
### 波特率
 串口通信的速率用波特率表示，它表示每秒传输二进制数据的位数，单位是bps（ 位
/秒） ，常用的波特率有9600、 19200、 38400、 57600以及115200等。（设置通过工作时钟与波特率之比可计算一位数据传输周期）

### 串口协议
#### 串口协议是什么
串口协议本质就是数据无法以并行的形式在线路中传递，因此接收者的需求是把串行的数据转成并行的数据，存储起来或发送给别的模块使用，发送者的任务是把并行的数据转为串行的数据，发送出去。
#### 串口协议数据包的内容
* 开始标志位：标志数据开始
* 附加数据
* 结束标志位：标志数据结束
* 奇偶校验位
* 我所使用的是长度为8位一帧的数据格式。
#### 基于verilog设计的回环结构
* 发送模块
* 接收模块
* 顶层模块
* 回环模块
## 第一次编写
### 方式
使用了常规方法，设置了三个计数器。存在问题严重，我并不知道最终的结果是不是正确的，因为仿真看起来没有什么问题。
### 问题
* 存在的问题就是对于没有编程经验的我来说，同步时序的方式并不能很快适应，这导致我多次出现了一个接口的数据来源不唯一的错误额。
* 计数器很多，不能说令人困惑，只能说无从下手。
* 逻辑其实相通并不难，理解也不难，但是让代码有序整洁是最困难的部分。
## 第二次编写
### 方式
用了有限状态机的思想。
### 优点
* 消灭了两个计数器，完全不需要考虑总体长度，只需要考虑状态。简化了思维。


## 遇到的坑
* 思维惯性
写程序写成习惯了，对硬件描述语言一时间适应不了，自动带入顺序执行；举个例子
```
a<=b;
c<=a;
```
一开始以为是先执行第一句，再执行第二句，事实上并不是，而是同时执行，按照面向过程的思维习惯，应该是
```
t=a;
a=b;
c=t;
```
事实上在verilog中这种写法
```
a<=b;
c<=a;
```
在某种意义上可以用来判断上升沿和下降沿

## 结语
* 两次代码都在文件夹里，第一次的叫PortCommunication,第二次的叫PortCommunication2
* ASM框图也在此文件夹里。

